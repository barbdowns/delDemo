<%= render 'partials/banner' %>

<h2 class='home-header mt-5'>Search for Data Elements by ID or Text</h2>
<div class='search-container'>
    <form class='search-form' action="/search" accept-charset="UTF-8" method="get">
        <select name='assessment' class='form-control search-dropdown'>
            <option value=''>All Forms</option>
            <option value='' disabled>---------------</option>
            <option value='' disabled>Active Forms</option>
            <option value='' disabled>---------------</option>
            <% @qssActive.each do |av| %>
                <% if av[:id].eql?(@assessmentID) %>
                    <option value="<%= av[:id] -%>" selected><%= av[:name] -%></option>
                <% else %>
                    <option value="<%= av[:id] -%>"><%= av[:name] -%></option>
                <% end %>
            <% end %>
            <option value='' disabled>---------------</option>
            <option value='' disabled>Inactive Forms</option>
            <option value='' disabled>---------------</option>
            <% @qssInactive.each do |iv| %>
                <% if iv[:id].eql?(@assessmentID) %>
                    <option value="<%= iv[:id] -%>" selected><%= iv[:name] -%></option>
                <% else %>
                    <option value="<%= iv[:id] -%>"><%= iv[:name] -%></option>
                <% end %>
            <% end %>
        </select>
        <div class="input-group">
            <input type="text" name="input" class="form-control" placeholder="DEL Search" 
                    aria-label="DEL Search" aria-describedby="basic-addon2" value="<%= @input -%>">
            <div class="input-group-append">
                <button class="btn btn-primary" type="submit">Search</button>
            </div>
        </div>
    </form>
</div>

<div class='search-table-container'>
    <table class='search-table'>
        <tbody>
            <tr>
                <th class='search-table-col-assessment'>Assessment</th>
                <th class='search-table-col-id'>ID</th>
                <th>Text</th>
                <th>Answer Type</th>
            </tr>
            <tr>
                <td class='search-table-col-assessment'><%= @assessmentName -%></td>
                <td class='search-table-col-id'><%= @item.prefix -%></td>
                <td><%= @item.text -%></td>
                <td><%= @item.type -%></td>
            </tr>
        </tbody>
    </table>
</div>

<% if @item.type.include?("choice") %>
    <div class='search-table-container'>
        <table class='search-table'>
            <tbody>
                <tr>
                    <th>Answer Option</th>
                    <th>Code</th>
                    <% if @item.answerOption && @item.answerOption.any?{ |ao| ao.valueCoding && ao.valueCoding.system.present? } %>
                        <th>Code System</th>
                    <% end %>
                </tr>
                <% @item.answerOption.each do |ao| %>
                    <tr>
                        <td><%= ao.valueCoding.display %></td>
                        <td><%= ao.valueCoding.code %></td>
                        <% if ao.valueCoding.system.present? %>
                            <td>
                                <a href='<%= ao.valueCoding.system %>' target='_blank'><%= ao.valueCoding.system %></a>
                            </td>
                        <% end %>
                    </tr>
                <% end %>
            </tbody>
        </table>
    </div>
<% end %>